<h2>Orders List</h2>
<button mat-raised-button color="primary" [routerLink]="'/orders/create'" style="margin-bottom: 16px;">
  Create New Order
</button>
<table mat-table [dataSource]="orders" class="mat-elevation-z8" multiTemplateDataRows>
  <!-- Actions Column -->
  <ng-container matColumnDef="actions">
    <th mat-header-cell *matHeaderCellDef></th>
    <td mat-cell *matCellDef="let order">
      <button mat-icon-button (click)="expandedOrder = expandedOrder === order ? null : order; $event.stopPropagation()">
        <mat-icon>
          {{ expandedOrder === order ? 'expand_less' : 'expand_more' }}
        </mat-icon>
      </button>
      <button mat-icon-button color="primary"
        [routerLink]="['/orders/create']"
        [queryParams]="{ id: order.orderId }"
        (click)="$event.stopPropagation()"
        aria-label="Edit Order">
        <mat-icon>edit</mat-icon>
      </button>
      <button mat-icon-button color="warn"
        (click)="deleteOrder(order); $event.stopPropagation()"
        aria-label="Delete Order">
        <mat-icon>delete</mat-icon>
      </button>
    </td>
  </ng-container>

  <ng-container matColumnDef="id">
    <th mat-header-cell *matHeaderCellDef> Order ID </th>
    <td mat-cell *matCellDef="let order"> {{ order.orderId }} </td>
  </ng-container>
  <ng-container matColumnDef="customer">
    <th mat-header-cell *matHeaderCellDef> Customer </th>
    <td mat-cell *matCellDef="let order"> {{ order.customerName }} </td>
  </ng-container>
  <ng-container matColumnDef="date">
    <th mat-header-cell *matHeaderCellDef> Date </th>
    <td mat-cell *matCellDef="let order"> {{ order.orderDate | date }} </td>
  </ng-container>
  <ng-container matColumnDef="total">
    <th mat-header-cell *matHeaderCellDef> Total </th>
    <td mat-cell *matCellDef="let order"> {{ order.totalAmount | currency }} </td>
  </ng-container>

  <!-- Detail Row (unchanged) -->
  <ng-container matColumnDef="expandedDetail">
    <td mat-cell *matCellDef="let order" [attr.colspan]="columns.length">
      <div *ngIf="expandedOrder === order">
        <h4>Order Details</h4>
        <table mat-table [dataSource]="order.orderDetails || []" class="mat-elevation-z1" style="width: 100%; margin-bottom: 8px;">
          <ng-container matColumnDef="product">
            <th mat-header-cell *matHeaderCellDef>Product</th>
            <td mat-cell *matCellDef="let item">{{ item.product?.name || item.productId }}</td>
          </ng-container>
          <ng-container matColumnDef="quantity">
            <th mat-header-cell *matHeaderCellDef>Quantity</th>
            <td mat-cell *matCellDef="let item">{{ item.quantity | number }}</td>
          </ng-container>
          <ng-container matColumnDef="amount">
            <th mat-header-cell *matHeaderCellDef>Amount</th>
            <td mat-cell *matCellDef="let item">{{ item.amount | currency }}</td>
          </ng-container>
          <tr mat-header-row *matHeaderRowDef="['product', 'quantity', 'amount']"></tr>
          <tr mat-row *matRowDef="let row; columns: ['product', 'quantity', 'amount']"></tr>
          <tr *ngIf="!(order.orderDetails?.length)">
            <td colspan="3" style="text-align:center; color:#888;">No details available.</td>
          </tr>
        </table>
      </div>
    </td>
  </ng-container>

  <tr mat-header-row *matHeaderRowDef="columns"></tr>
  <tr mat-row *matRowDef="let order; columns: columns"></tr>
  <tr mat-row *matRowDef="let order; columns: ['expandedDetail']" class="detail-row"></tr>
</table>
